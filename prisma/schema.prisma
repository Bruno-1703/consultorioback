datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

type CitaEnfermedad {
  id_enfermedad String   @map("_id") @db.ObjectId
  nombre_enf    String?
  fecha         DateTime @default(now()) @db.Date
}

type CitaEstudio {
  id_estudio        String   @map("_id") @db.ObjectId
  fecha_realizacion DateTime?
  codigo_referencia String?
  observaciones      String?
  resultado          String?
  tipo_estudio       String?
  medico_solicitante String?
}

type PacienteCita {
  id_paciente String?
  dni             String?
  nombre_paciente String?
  apellido_paciente String?
}
type CitaDoctor {
  id_Usuario     String ?
  nombre_usuario String?
  email          String?
  especialidad     String?
  matricula        String ?  
  telefono         String?
  nombre_completo String?
  dni              String?
}

type CitaMedicamento {
  id_medicamento String
  nombre_med     String?
}

model Cita {
  id_cita           String            @id @default(auto()) @map("_id") @db.ObjectId
  motivoConsulta    String?

 fechaProgramada     DateTime           /// Fecha y hora solicitada por el paciente
  fechaCreacion       DateTime           @default(now())     /// Se genera automáticamente
  fechaModificacion   DateTime?          @updatedAt          /// Se actualiza automáticamente

  observaciones     String?
  cancelada         Boolean           @default(false)
  enfermedades        CitaEnfermedad[]
  medicamentos       CitaMedicamento[]
  estudios           CitaEstudio[]
  paciente          PacienteCita
  finalizada        Boolean           @default(false)
  doctor    CitaDoctor
  registradoPorId   String?
}

model Estudio {
  id_estudio         String   @id @default(auto()) @map("_id") @db.ObjectId
  fecha_realizacion  DateTime
  tipo_estudio       String
  resultado          String?
  codigo_referencia  String
  observaciones      String?
  medico_solicitante String?
  urgente            Boolean?
}

model Medicamento {
  id_medicamento         String    @id @default(auto()) @map("_id") @db.ObjectId
  nombre_med             String?
  marca                  String?
  fecha_vencimiento      DateTime?
  dosis_hs               String?
  agente_principal       String?
  efectos_secundarios    String?
  lista_negra            Boolean?
  categoria              String?
  contraindicaciones     String?
  prescripcion_requerida Boolean?
  eliminadoLog           Boolean  @default(false)
  stock                  Int       @default(0) 
}

model Enfermedad {
  id_enfermedad String  @id @default(auto()) @map("_id") @db.ObjectId
  nombre_enf    String
  sintomas      String
  gravedad      String?
   eliminadoLog       Boolean @default(false)

}

model Paciente {
  id_paciente       String         @id @default(auto()) @map("_id") @db.ObjectId
  dni               String?
  nombre_paciente   String?
  apellido_paciente String?
  edad              Int?
  altura            Int?
  telefono          String?
  fecha_nacimiento  DateTime?
  sexo              String?
  grupo_sanguineo   String?
  alergias          String?
  obra_social       String?    // Nuevo
  email             String?    // Nuevo
  direccion         String?    // Nuevo
  nacionalidad      String?    // Nuevo
  eliminadoLog      Boolean  @default(false)
  internaciones Internacion[]

}
model Cama {
  id_cama    String   @id @default(auto()) @map("_id") @db.ObjectId
  numero     String
  disponible Boolean @default(true)
  pabellonId String?
  pabellon   Pabellon? @relation(fields: [pabellonId], references: [id_pabellon])
  internaciones Internacion[]
}

model Pabellon {
  id_pabellon String @id @default(auto()) @map("_id") @db.ObjectId
  nombre      String
  descripcion String?
  camas       Cama[]
}

model Internacion {
  id_internacion String @id @default(auto()) @map("_id") @db.ObjectId
  pacienteId     String
  camaId         String
  paciente       Paciente @relation(fields: [pacienteId], references: [id_paciente])
  cama           Cama     @relation(fields: [camaId], references: [id_cama])
  fecha_ingreso  DateTime @default(now())
  fecha_alta     DateTime?
  diagnostico    String?
  observaciones  String?
  activa         Boolean  @default(true)
}












model Usuario {
  id_Usuario     String  @id @default(auto()) @map("_id") @db.ObjectId
  nombre_usuario String
  email          String  @unique
  password       String
  deletLogico    Boolean @default(false)
  rol_usuario    String
  nombre_completo  String
  especialidad     String
  matricula        String   @unique
  dni              String   @unique
  telefono         String?
  resetToken        String?
resetTokenExpiry  DateTime?

}

enum Accion {
  CREATE
  UPDATE
  DELETE
  READ
  ARCHIVE
}

model Auditoria {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  accion       Accion
  usuarioId    String?
  usuarioNom   String?
  detalles     String?
  model        String
  registro_id  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([usuarioId])
  @@index([model])
  @@index([registro_id])
}

